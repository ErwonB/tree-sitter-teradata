================================================================================
Simple update
================================================================================

UPDATE my_table
SET for = foo + 1;

--------------------------------------------------------------------------------

(program
  (statement
    (update
      (keyword_update)
      (relation
        (object_reference
          name: (identifier)))
      (keyword_set)
      (assignment
        left: (field
          name: (identifier))
        right: (binary_expression
          left: (field
            name: (identifier))
          right: (literal))))))

================================================================================
update with multiple assignments
================================================================================

UPDATE my_table
SET for = foo + 1, col2 = col1;

--------------------------------------------------------------------------------

(program
  (statement
    (update
      (keyword_update)
      (relation
        (object_reference
          name: (identifier)))
      (keyword_set)
      (assignment
        left: (field
          name: (identifier))
        right: (binary_expression
          left: (field
            name: (identifier))
          right: (literal)))
      (assignment
        left: (field
          name: (identifier))
        right: (field
          name: (identifier))))))

================================================================================
update with multiple table references
================================================================================

UPDATE items, months
SET items.price=months.price
WHERE items.id=months.item_id;

--------------------------------------------------------------------------------

(program
  (statement
    (update
      (keyword_update)
      (relation
        (object_reference
          name: (identifier)))
      (relation
        (object_reference
          name: (identifier)))
      (keyword_set)
      (assignment
        left: (field
          (object_reference
            name: (identifier))
          name: (identifier))
        right: (field
          (object_reference
            name: (identifier))
          name: (identifier)))
      (where
        (keyword_where)
        predicate: (binary_expression
          left: (field
            (object_reference
              name: (identifier))
            name: (identifier))
          right: (field
            (object_reference
              name: (identifier))
            name: (identifier)))))))

================================================================================
update with function call
================================================================================

UPDATE my_table
SET ts = now();

--------------------------------------------------------------------------------

(program
  (statement
    (update
      (keyword_update)
      (relation
        (object_reference
          name: (identifier)))
      (keyword_set)
      (assignment
        left: (field
          name: (identifier))
        right: (invocation
          (object_reference
            name: (identifier)))))))

================================================================================
Update with a JOIN
================================================================================

UPDATE table_a a
INNER JOIN table_b b ON b.a = a.uid
INNER JOIN table_c c ON c.b = b.uid
SET
a.d = 5;

--------------------------------------------------------------------------------

(program
  (statement
    (update
      (keyword_update)
      (relation
        (object_reference
          (identifier))
        (identifier))
      (join
        (keyword_inner)
        (keyword_join)
        (relation
          (object_reference
            (identifier))
          (identifier))
        (keyword_on)
        (binary_expression
          (field
            (object_reference
              (identifier))
            (identifier))
          (field
            (object_reference
              (identifier))
            (identifier))))
      (join
        (keyword_inner)
        (keyword_join)
        (relation
          (object_reference
            (identifier))
          (identifier))
        (keyword_on)
        (binary_expression
          (field
            (object_reference
              (identifier))
            (identifier))
          (field
            (object_reference
              (identifier))
            (identifier))))
      (keyword_set)
      (assignment
        (field
          (object_reference
            (identifier))
          (identifier))
        (literal)))))

================================================================================
Postgres style update
================================================================================

UPDATE table_a as a
SET d = 5
WHERE b.a = a.uid;

--------------------------------------------------------------------------------

(program
  (statement
    (update
      (keyword_update)
      (relation
        (object_reference
          (identifier))
        (keyword_as)
        (identifier))
      (keyword_set)
      (assignment
        (field
          (identifier))
        (literal))
      (where
        (keyword_where)
        (binary_expression
          (field
            (object_reference
              (identifier))
            (identifier))
          (field
            (object_reference
              (identifier))
            (identifier)))))))

================================================================================
to be tested in teradata Postgres style update w/ join
================================================================================

UPDATE table_a as a
SET d = 5
FROM table_b b
INNER JOIN table_c c ON c.b = b.uid
WHERE b.a = a.uid;

--------------------------------------------------------------------------------

(program
  (statement
    (update
      (keyword_update)
      (relation
        (object_reference
          (identifier))
        (keyword_as)
        (identifier))
      (keyword_set)
      (assignment
        (field
          (identifier))
        (literal))
      (from
        (keyword_from)
        (relation
          (object_reference
            (identifier))
          (identifier))
        (join
          (keyword_inner)
          (keyword_join)
          (relation
            (object_reference
              (identifier))
            (identifier))
          (keyword_on)
          (binary_expression
            (field
              (object_reference
                (identifier))
              (identifier))
            (field
              (object_reference
                (identifier))
              (identifier))))
        (where
          (keyword_where)
          (binary_expression
            (field
              (object_reference
                (identifier))
              (identifier))
            (field
              (object_reference
                (identifier))
              (identifier))))))))


================================================================================
Teradata style update 1
================================================================================

NONTEMPORAL
UPDATE TGT
FROM
		db1.table1 TGT
	,	(
		nonsequenced transactiontime
		SELECT
			field1
        ,   field2
        ,   field3
        ,   field4
		FROM
			db1.table2
		where field4 is not null
		and   field1 is not null
		QUALIFY ROW_NUMBER () OVER (PARTITION BY field2 ORDER BY field5 DESC) = 1
		) SRC

SET field4 = SRC.field4
WHERE
	TGT.field1 = SRC.field1
AND	TGT.field4 IS NULL
;

--------------------------------------------------------------------------------
    (program
      (statement
        (keyword_nontemporal)
        (update
          (keyword_update)
          (object_reference
            (identifier))
          (keyword_from)
          (relation
            (object_reference
              (identifier)
              (identifier))
            (identifier))
          (relation
            (subquery
              (temporal_modifier
                (keyword_nonsequenced)
                (keyword_transactiontime))
              (select
                (keyword_select)
                (select_expression
                  (term
                    (field
                      (identifier)))
                  (term
                    (field
                      (identifier)))
                  (term
                    (field
                      (identifier)))
                  (term
                    (field
                      (identifier)))))
              (from
                (keyword_from)
                (relation
                  (object_reference
                    (identifier)
                    (identifier)))
                (where
                  (keyword_where)
                  (binary_expression
                    (binary_expression
                      (field
                        (identifier))
                      (is_not
                        (keyword_is)
                        (keyword_not))
                      (literal
                        (keyword_null)))
                    (keyword_and)
                    (binary_expression
                      (field
                        (identifier))
                      (is_not
                        (keyword_is)
                        (keyword_not))
                      (literal
                        (keyword_null)))))
                (qualify
                  (keyword_qualify)
                  (binary_expression
                    (window_function
                      (invocation
                        (object_reference
                          (identifier)))
                      (keyword_over)
                      (window_specification
                        (partition_by
                          (keyword_partition)
                          (keyword_by)
                          (field
                            (identifier)))
                        (order_by
                          (keyword_order)
                          (keyword_by)
                          (order_target
                            (field
                              (identifier))
                            (direction
                              (keyword_desc))))))
                    (literal)))))
            (identifier))
          (keyword_set)
          (assignment
            (field
              (identifier))
            (field
              (object_reference
                (identifier))
              (identifier)))
          (where
            (keyword_where)
            (binary_expression
              (binary_expression
                (field
                  (object_reference
                    (identifier))
                  (identifier))
                (field
                  (object_reference
                    (identifier))
                  (identifier)))
              (keyword_and)
              (binary_expression
                (field
                  (object_reference
                    (identifier))
                  (identifier))
                (keyword_is)
                (literal
                  (keyword_null))))))))


================================================================================
Teradata style update 2
================================================================================
     UPDATE t
    FROM db1.table1 t,
         db2.table2 s,
         db3.table3 dd
    SET
        field1 = s.field1
    WHERE s.field2 = dd.field2
      AND s.field3 = t.field3
;
--------------------------------------------------------------------------------
    (program
      (statement
        (update
          (keyword_update)
          (object_reference
            (identifier))
          (keyword_from)
          (relation
            (object_reference
              (identifier)
              (identifier))
            (identifier))
          (relation
            (object_reference
              (identifier)
              (identifier))
            (identifier))
          (relation
            (object_reference
              (identifier)
              (identifier))
            (identifier))
          (keyword_set)
          (assignment
            (field
              (identifier))
            (field
              (object_reference
                (identifier))
              (identifier)))
          (where
            (keyword_where)
            (binary_expression
              (binary_expression
                (field
                  (object_reference
                    (identifier))
                  (identifier))
                (field
                  (object_reference
                    (identifier))
                  (identifier)))
              (keyword_and)
              (binary_expression
                (field
                  (object_reference
                    (identifier))
                  (identifier))
                (field
                  (object_reference
                    (identifier))
                  (identifier))))))))

================================================================================
Teradata style update 3
================================================================================
    update db1.table1
    from (
        select field1
             , field2
             , field3
          from db2.table2
    ) as f
    set field1 = f.field1
      , field4  = 1
    where table1.field2  = f.field2
      and table1.field3  = f.field3
    ;
--------------------------------------------------------------------------------


    (program
      (statement
        (update
          (keyword_update)
          (object_reference
            (identifier)
            (identifier))
          (keyword_from)
          (relation
            (subquery
              (select
                (keyword_select)
                (select_expression
                  (term
                    (field
                      (identifier)))
                  (term
                    (field
                      (identifier)))
                  (term
                    (field
                      (identifier)))))
              (from
                (keyword_from)
                (relation
                  (object_reference
                    (identifier)
                    (identifier)))))
            (keyword_as)
            (identifier))
          (keyword_set)
          (assignment
            (field
              (identifier))
            (field
              (object_reference
                (identifier))
              (identifier)))
          (assignment
            (field
              (identifier))
            (literal))
          (where
            (keyword_where)
            (binary_expression
              (binary_expression
                (field
                  (object_reference
                    (identifier))
                  (identifier))
                (field
                  (object_reference
                    (identifier))
                  (identifier)))
              (keyword_and)
              (binary_expression
                (field
                  (object_reference
                    (identifier))
                  (identifier))
                (field
                  (object_reference
                    (identifier))
                  (identifier))))))))
